# HashiCorp Vault Helm Chart Values
# Install: helm install vault hashicorp/vault -f values.yaml -n vault

global:
  enabled: true
  tlsDisable: false  # Enable TLS in production

# Vault Server
server:
  image:
    repository: "hashicorp/vault"
    tag: "1.15.2"
    pullPolicy: IfNotPresent

  # HA Mode using Raft Integrated Storage
  ha:
    enabled: true
    replicas: 3

    # Raft configuration
    raft:
      enabled: true
      setNodeId: true

      config: |
        ui = true

        listener "tcp" {
          tls_disable = 1  # Set to 0 in production with proper TLS
          address = "[::]:8200"
          cluster_address = "[::]:8201"
        }

        storage "raft" {
          path = "/vault/data"

          retry_join {
            leader_api_addr = "http://vault-0.vault-internal:8200"
          }

          retry_join {
            leader_api_addr = "http://vault-1.vault-internal:8200"
          }

          retry_join {
            leader_api_addr = "http://vault-2.vault-internal:8200"
          }
        }

        service_registration "kubernetes" {}

  # Resources
  resources:
    requests:
      memory: 512Mi
      cpu: 500m
    limits:
      memory: 1Gi
      cpu: 1000m

  # Storage
  dataStorage:
    enabled: true
    size: 10Gi
    storageClass: null  # Use default
    accessMode: ReadWriteOnce

  auditStorage:
    enabled: true
    size: 10Gi
    storageClass: null
    accessMode: ReadWriteOnce

  # Service
  service:
    enabled: true
    type: ClusterIP
    port: 8200
    targetPort: 8200

  # Ingress
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: vault.company.local
        paths:
          - /
    tls:
      - secretName: vault-tls
        hosts:
          - vault.company.local

  # Standalone mode (alternative to HA for testing)
  standalone:
    enabled: false

# Vault UI
ui:
  enabled: true
  serviceType: "ClusterIP"
  externalPort: 8200

# Vault Injector (for automatic secret injection)
injector:
  enabled: true

  image:
    repository: "hashicorp/vault-k8s"
    tag: "1.3.1"

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  # Mutation webhook
  webhook:
    failurePolicy: Ignore

  # Agent defaults
  agentDefaults:
    cpuLimit: "500m"
    cpuRequest: "250m"
    memLimit: "128Mi"
    memRequest: "64Mi"

# Service Account
serverServiceAccount:
  create: true
  name: "vault"

# RBAC
rbac:
  create: true
